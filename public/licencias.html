<!DOCTYPE html>
<html lang="es">
<head>
<script src="/js/auth.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INTEK-IT | Licencias</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="/css/licencias.css">
</head>

<body>
<script>
const user = JSON.parse(localStorage.getItem('user') || 'null');
requireAuth(['adminIT', 'rrhh', 'manager']);
document.addEventListener('DOMContentLoaded', () => {
  if (!user) return;
  const navLinks = document.querySelectorAll('nav a');
  navLinks.forEach(link => {
    if (user.rol === 'adminIT') return; // adminIT ve todo
    if (link.href.includes('inventario.html') && !['adminIT','tecnico'].includes(user.rol)) link.style.display = 'none';
    if (link.href.includes('empleados.html') && !['adminIT','rrhh'].includes(user.rol)) link.style.display = 'none';
    if (link.href.includes('licencias.html') && !['adminIT','rrhh','manager'].includes(user.rol)) link.style.display = 'none';
    if (link.href.includes('usuarios.html') && user.rol !== 'adminIT') link.style.display = 'none';
    if (user.rol === 'manager' && !(link.href.includes('dashboard.html') || link.href.includes('controlgastos.html') || link.href.includes('licencias.html'))) link.style.display = 'none';
    if (user.rol === 'empleado' && !(link.href.includes('dashboard.html') || link.href.includes('helpdesk'))) link.style.display = 'none';
  });
});
</script>

<!-- ================= SIDEBAR ================= -->
<aside>
  <div class="logo">INTEK-IT</div>
  <nav>
    <a href="/dashboard.html"><i class="fa-solid fa-chart-line"></i> <span>Dashboard</span></a>
    <a href="/inventario.html"><i class="fa-solid fa-desktop"></i> <span>Inventario IT</span></a>
    <a href="/licencias.html" class="active"><i class="fa-solid fa-key"></i> <span>Licencias</span></a>
    <a href="/controlgastos.html"><i class="fa-solid fa-coins"></i> <span>Gastos</span></a>
    <a href="/dominios.html"><i class="fa-solid fa-globe"></i> <span>Dominios</span></a>
    <a href="/empleados.html"><i class="fa-solid fa-users"></i> <span>Empleados</span></a>
    <a href="/helpdesk.html"><i class="fa-solid fa-headset"></i> <span>Helpdesk</span></a>
    <a href="/tickets.html"><i class="fa-solid fa-ticket"></i> <span>Tickets</span></a>
    <a href="/usuarios.html"><i class="fa-solid fa-users"></i> <span>Usuarios</span></a>
    <a href="#" id="btnLogout"><i class="fa-solid fa-right-from-bracket"></i> <span>Salir</span></a>
  </nav>
</aside>

<!-- ================= MAIN ================= -->
<div class="main-content">

<header>
  <h1><i class="fa-solid fa-gauge"></i> Panel de Control</h1>
  <a href="/login.html"><i class="fa-solid fa-arrow-right-from-bracket"></i> Cerrar sesión</a>
</header>

<div class="container">
  <!-- MODAL NUEVA LICENCIA -->
  <div class="modal-overlay" id="modalAddOverlay">
    <div class="modal-container" id="modalAddForm">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fa-solid fa-key"></i> Añadir Licencia</h2>
        <button type="button" class="modal-close" id="btnCancelAdd"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <form id="formAddLicencia">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label required">Software</label>
            <input type="text" name="software" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label required">Nombre Licencia</label>
            <input type="text" name="nombreLicencia" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label required">Licencia</label>
            <input type="text" name="licencia" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Empleado Asignado</label>
            <select name="empleadoAsignado" id="add_empleadoAsignado" class="form-select"><option value="">Cargando...</option></select>
          </div>
          <div class="form-group">
            <label class="form-label">Departamento</label>
            <input type="text" name="departamento" class="form-input">
          </div>
          <div class="form-group">
            <label class="form-label">Proveedor</label>
            <input type="text" name="proveedor" class="form-input">
          </div>
          <div class="form-group">
            <label class="form-label">Expiración</label>
            <input type="date" name="expiracion" class="form-input">
          </div>
          <input type="text" name="estado" style="display:none;">
          <div class="form-group">
            <label class="form-label">Fecha Adquisición</label>
            <input type="date" name="fechaAdquisicion" class="form-input">
          </div>
          <div class="form-group">
            <label class="form-label">Fecha Última Renovación</label>
            <input type="date" name="fechaUltimaRenovacion" class="form-input">
          </div>
          <div class="form-group">
            <label class="form-label">Fecha Renovación</label>
            <input type="date" name="fechaRenovacion" class="form-input">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Guardar</button>
          <button type="button" class="btn btn-danger" id="btnCancelAddFooter">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- == STATS == -->
  <div class="stats">
    <div class="card"><i class="fa-solid fa-key"></i><h3>Total Licencias</h3><span id="totalLicencias">0</span></div>
    <div class="card"><i class="fa-solid fa-hourglass-half"></i><h3>Próximas a Caducar</h3><span id="proximas">0</span></div>
    <div class="card"><i class="fa-solid fa-ban"></i><h3>Caducadas</h3><span id="caducadas">0</span></div>
  </div>

  <!-- == SEARCH FILTERS == -->
  <div class="search-filter">
    <input type="text" id="searchLicInput" placeholder="Buscar por software, usuario o proveedor">
    <select id="filterLicEstado">
      <option value="">Estado</option>
      <option value="Activa">Activa</option>
      <option value="Próxima a caducar">Próxima a caducar</option>
      <option value="Caducada">Caducada</option>
    </select>
    <button id="btnAddLicense"><i class="fa-solid fa-plus"></i> Añadir</button>
  </div>

  <!-- == TABLE == -->
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Software</th>
          <th>Licencia</th>
          <th>Proveedor</th>
          <th>Usuario</th>
          <th>Expira</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="licenseTableBody"></tbody>
    </table>
  </div>

</div>

<footer>&copy; 2025 INTEK-IT. Todos los derechos reservados.</footer>

</div>
<script src="/js/licencias.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
<script src="/js/auth.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INTEK-IT | Licencias</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="/css/licencias.css">
</head>

<body>
<script>
const user = JSON.parse(localStorage.getItem('user') || 'null');
requireAuth(['adminIT', 'rrhh', 'manager']);
document.addEventListener('DOMContentLoaded', () => {
  if (!user) return;
  const navLinks = document.querySelectorAll('nav a');
  navLinks.forEach(link => {
    if (user.rol === 'adminIT') return; // adminIT ve todo
    if (link.href.includes('inventario.html') && !['adminIT','tecnico'].includes(user.rol)) link.style.display = 'none';
    if (link.href.includes('empleados.html') && !['adminIT','rrhh'].includes(user.rol)) link.style.display = 'none';
    if (link.href.includes('licencias.html') && !['adminIT','rrhh','manager'].includes(user.rol)) link.style.display = 'none';
    if (link.href.includes('usuarios.html') && user.rol !== 'adminIT') link.style.display = 'none';
    if (user.rol === 'manager' && !(link.href.includes('dashboard.html') || link.href.includes('controlgastos.html') || link.href.includes('licencias.html'))) link.style.display = 'none';
    if (user.rol === 'empleado' && !(link.href.includes('dashboard.html') || link.href.includes('helpdesk'))) link.style.display = 'none';
  });
});
</script>

<!-- ================= SIDEBAR ================= -->
<aside>
  <div class="logo">INTEK-IT</div>
  <nav>
    <a href="/dashboard.html"><i class="fa-solid fa-chart-line"></i> <span>Dashboard</span></a>
    <a href="/inventario.html"><i class="fa-solid fa-desktop"></i> <span>Inventario IT</span></a>
    <a href="/licencias.html" class="active"><i class="fa-solid fa-key"></i> <span>Licencias</span></a>
    <a href="/controlgastos.html"><i class="fa-solid fa-coins"></i> <span>Gastos</span></a>
    <a href="/dominios.html"><i class="fa-solid fa-globe"></i> <span>Dominios</span></a>
    <a href="/empleados.html"><i class="fa-solid fa-users"></i> <span>Empleados</span></a>
      <a href="#"><i class="fa-solid fa-headset"></i> <span>Helpdesk</span></a>
    <a href="#" id="btnLogout"><i class="fa-solid fa-sign-out-alt"></i> <span>Salir</span></a>
  </nav>
</aside>

<!-- ================= MAIN ================= -->
<div class="main-content">

<header>
  <h1><i class="fa-solid fa-key"></i> Gestión de Licencias</h1>
  <a href="/dashboard.html"><i class="fa-solid fa-arrow-left"></i> Volver</a>
</header>

<div class="container">
  <!-- MODAL NUEVA LICENCIA -->
  <div id="modalAddOverlay" style="display:none;">
    <div class="modal" id="modalAddForm">
      <h3>Añadir Licencia</h3>
      <form id="formAddLicencia">
  <label>Software:<input type="text" name="software" required></label>
  <label>Nombre Licencia:<input type="text" name="nombreLicencia" required></label>
  <label>Licencia:<input type="text" name="licencia" required></label>
  <label>Empleado Asignado:<select name="empleadoAsignado" id="add_empleadoAsignado"><option value="">Cargando...</option></select></label>
  <label>Departamento:<input type="text" name="departamento"></label>
  <label>Proveedor:<input type="text" name="proveedor"></label>
  <label>Expiración:<input type="date" name="expiracion"></label>
  <label>Estado:<input type="text" name="estado" style="display:none;"></label>
  <label>Fecha Adquisición:<input type="date" name="fechaAdquisicion"></label>
  <label>Fecha Última Renovación:<input type="date" name="fechaUltimaRenovacion"></label>
  <label>Fecha Renovación:<input type="date" name="fechaRenovacion"></label>
        <div class="actions">
          <button type="submit" class="btn">Guardar</button>
          <button type="button" class="btn cancel" id="btnCancelAdd">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- == STATS == -->
  <div class="stats">
    <div class="card"><h3>Total Licencias</h3><span id="totalLicencias">0</span></div>
    <div class="card"><h3>Próximas a Caducar</h3><span id="proximas">0</span></div>
    <div class="card"><h3>Caducadas</h3><span id="caducadas">0</span></div>
  </div>

  <!-- == SEARCH FILTERS == -->
  <div class="search-filter">
    <input type="text" id="searchLicInput" placeholder="Buscar por software, usuario o proveedor">
    <select id="filterLicEstado">
      <option value="">Estado</option>
      <option value="Activa">Activa</option>
      <option value="Próxima a caducar">Próxima a caducar</option>
      <option value="Caducada">Caducada</option>
    </select>
    <button id="btnAddLicense"><i class="fa-solid fa-plus"></i> Añadir</button>
  </div>

  <!-- == TABLE == -->
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Software</th>
          <th>Licencia</th>
          <th>Proveedor</th>
          <th>Usuario</th>
          <th>Expira</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="licenseTableBody"></tbody>
    </table>
  </div>

</div>

<footer>&copy; 2025 INTEK-IT. Todos los derechos reservados.</footer>

</div>
<script src="/js/licencias.js"></script>
</body>
</html>